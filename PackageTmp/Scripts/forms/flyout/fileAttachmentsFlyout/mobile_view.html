<div class="cireson-window defined-form task-window hide">
    <div class="cireson-window--wrapper cs-form__flyout--attachment">
        <div class="cireson-window--body">
            <div>
                <div class="fileattachment-list"></div>
                <div class="fileattachment-img-modal"></div>
            </div>

            <script type="text/x-kendo-template" id="filesTemplate">
                <div class="thumbnail-file">
                    <div class="cursor-pointer thumbnail-img">
                        # if (DisplayName.toLowerCase().match(/\.(jpg|jpeg|png|gif)$/)) { #
                        <img src="data:image/png;base64,#= Content.data #" onerror="this.onerror = null; this.src = '/Content/Images/Icons/FileUpload/document.svg';" alt="#: DisplayName # image" />
                        # } else{ #
                        <img class="default-icon" src="/Content/Images/Icons/FileUpload/document.svg" onerror="this.onerror = null; this.src = '/Content/Images/Icons/FileUpload/document.svg'">
                        # } #
                    </div>
                    <div class="thumbnail-caption">
                        <span>#: DisplayName #</span>
                        <div class="overlay">
                            # if (DisplayName.toLowerCase().match(/\.(jpg|jpeg|png|gif)$/)) { #
                            <span class="label">
                                <a class="icon custom-click" title="View Image" action="view">
                                    <i class="fa fa-eye"></i>
                                </a>
                            </span>
                            <span class="label">
                                <a class="icon custom-click" title="Open in New Tab" action="opennewtab">
                                    <i class="fa fa-external-link"></i>
                                </a>
                            </span>
                            # } #
                            <span class="label">
                                <a class="icon custom-click" title="Download" action="download">
                                    <i class="fa fa-download"></i>
                                </a>
                            </span>
                        </div>
                    </div>
                </div>
            </script>
            <script>
                function selectFile(el, action) {
                    //var listView = $(".fileattachment-list").data("kendoListView");
                    //var item = $(el).closest("[role='option']");
                    //var dataItem = listView.dataSource.getByUid(item.data("uid"));

                    //if (action === "download") {
                    //    var downloadUrl = app.config.rootURL + "FileAttachment/ViewFile/";
                    //    location.href = downloadUrl + dataItem.BaseId;
                    //} else if (action === "opennewtab") {
                    //    var win = window.open('about:blank');
                    //    setTimeout(function () { //FireFox seems to require a setTimeout for this to work.
                    //        win.document.body.appendChild(win.document.createElement('img')).src = el.closest(".thumbnail-file").find(".thumbnail-img img")[0].src;
                    //        win.href = el.closest(".thumbnail-file").find(".thumbnail-img img")[0].src;
                    //        win.focus();
                    //    }, 0);


                    //} else {
                    //    var dialog = $('.fileattachment-img-modal');
                    //    dialog.kendoDialog({
                    //        modal: true,
                    //        title: dataItem.DisplayName,
                    //        content: "<div class='file-img-container'><img src=\"data:image/png;base64," + dataItem.Content.data + "\" onerror=\"this.onerror = null; this.src = '/Content/Images/Icons/FileUpload/document.svg';\" alt=\"" + dataItem.DisplayName + "\" /></div>",
                    //        animation: {
                    //            open: {
                    //                effects: "fade:in"
                    //            }
                    //        }
                    //    });
                    //    $('.k-window.k-widget').addClass('acivity-popup-window');
                    //    dialog.data("kendoDialog").open();
                    //}
                }

            </script>
        </div>
        <div class="window-buttons cireson-window--footer">
            <button data-role="button"
                    class="btn btn-primary cs-form__flyout--save"
                    data-bind="events: { click: save }, visible: saveCancelBtn">
                <%= localization.OK %>
            </button>
            <button data-role="button"
                    class="btn btn-default cs-form__flyout--cancel"
                    data-bind="events: { click: cancel }, visible: saveCancelBtn">
                <%= localization.Cancel %>
            </button>
            <button data-role="button"
                    class="btn btn-default cs-form__flyout--close"
                    data-bind="events: { click: cancel}, visible: closeBtn ">
                <%= localization.Close %>
            </button>
        </div>
    </div>
</div>